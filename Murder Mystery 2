local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local Camera = Workspace.CurrentCamera

-- Variáveis de Controle
local xrayOriginals = {} 
local aimbotEnabled = true
local aimbotRange = 100 
local lastShotTime = 0
local fireRate = 0.5 

---------------------------------------------------------
-- 1. INFINITE JUMP (PULO INFINITO)
---------------------------------------------------------
UserInputService.JumpRequest:Connect(function()
    local character = player.Character
    local humanoid = character and character:FindFirstChildOfClass("Humanoid")
    if humanoid then
        humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
    end
end)

---------------------------------------------------------
-- 2. AIMBOT (TRAVA DE MIRA) - TECLA U
---------------------------------------------------------
RunService.RenderStepped:Connect(function()
    if not aimbotEnabled then return end
    
    local currentTime = tick()
    if currentTime - lastShotTime < fireRate then return end
    
    local nearestTarget = nil
    local minDistance = aimbotRange

    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= player and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            -- Verifica se o jogador local tem um RootPart antes de calcular a distância
            local myRoot = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
            if myRoot then
                local distance = (myRoot.Position - plr.Character.HumanoidRootPart.Position).Magnitude
                if distance < minDistance then
                    minDistance = distance
                    nearestTarget = plr.Character.HumanoidRootPart
                end
            end
        end
    end

    if nearestTarget then
        Camera.CFrame = CFrame.new(Camera.CFrame.Position, nearestTarget.Position)
        lastShotTime = currentTime
    end
end)

---------------------------------------------------------
-- 3. INPUTS (Y, U, K, J)
---------------------------------------------------------
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    -- TELEPORTE E PARAR ANIMAÇÃO (Y)
    if input.KeyCode == Enum.KeyCode.Y then
        local character = player.Character
        local humanoid = character and character:FindFirstChildOfClass("Humanoid")
        local root = character and character:FindFirstChild("HumanoidRootPart")
        
        if humanoid and root then
            for _, track in pairs(humanoid:GetPlayingAnimationTracks()) do
                track:Stop()
            end
            root.CFrame = root.CFrame * CFrame.new(0, 0, 7) -- 7 studs para trás
        end

    -- TOGGLE AIMBOT (U)
    elseif input.KeyCode == Enum.KeyCode.U then
        aimbotEnabled = not aimbotEnabled
        print("Aimbot:", aimbotEnabled)

    -- ATIVAR X-RAY (K)
    elseif input.KeyCode == Enum.KeyCode.K then
        for _, obj in pairs(Workspace:GetDescendants()) do
            if obj:IsA("BasePart") and not obj:IsDescendantOf(player.Character) then
                if not xrayOriginals[obj] then
                    xrayOriginals[obj] = obj.Transparency
                end
                obj.Transparency = 0.5
            end
        end

    -- DESATIVAR X-RAY (J)
    elseif input.KeyCode == Enum.KeyCode.J then
        for obj, originalValue in pairs(xrayOriginals) do
            if obj and obj.Parent then
                obj.Transparency = originalValue
            end
        end
        xrayOriginals = {} 
    end
end)
